const {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} = require("@google/generative-ai");

const apiKey = process.env.EXPO_PUBLIC_GOOGLE_GEMINI_API_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: "gemini-2.0-flash-exp",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

export const chatSession = model.startChat({
    generationConfig,
    history: [
      {
        role: "user",
        parts: [
          {text: "Generate {preferences} Travel Plan from Pahang, Malaysia to {location} as a {muslim}, for {number_of_days} Days for {travel_companions} with a {budget} budget with a Flight details, Flight Price with Booking url, Hotels options list with HotelName, Hotel address, Price, hotel image url, geo coordinates, rating, descriptions and Places to visit nearby with placeName, Place Details, Place Image Url, Geo Coordinates, ticket Pricing, Time travel each of the location for {number_of_days} days with each day plan with best time to visit in JSON format"},
        ],
      },
      {
        role: "model",
        parts: [
          {text: "Okay, I will craft a detailed travel plan in JSON format based on your preferences. Please be aware that prices are estimates and can fluctuate. I will include booking URLs for flights and hotels where available but always double-check before confirming.\n\nHere's the JSON output based on your specified placeholders:\n\n```json\n{\n  \"tripDetails\": {\n    \"origin\": \"Pahang, Malaysia\",\n    \"destination\": \"{location}\",\n    \"travelStyle\": \"Muslim-friendly\",\n    \"durationDays\": {number_of_days},\n    \"travelCompanions\": \"{travel_companions}\",\n    \"budget\": \"{budget}\",\n     \"travelPurpose\": \"{purpose_of_travel}\",\n      \"travelSeason\": \"{travel_season}\"\n  },\n    \"flightDetails\": {\n      \"estimatedFlightPrice\": \"RM {estimated_flight_price}\",\n       \"outboundFlight\": {\n        \"departureLocation\": \"Kuala Lumpur International Airport (KUL)\",\n         \"arrivalLocation\": \"{airport_code_destination}\",\n        \"departureTime\": \"{departure_date_time}\",\n        \"arrivalTime\": \"{arrival_date_time}\",\n        \"airline\":\"{airline_name_outbound}\",\n         \"flightDuration\": \"{flight_duration_outbound}\"\n      },\n       \"returnFlight\":{\n       \"departureLocation\": \"{airport_code_destination}\",\n        \"arrivalLocation\": \"Kuala Lumpur International Airport (KUL)\",\n         \"departureTime\": \"{departure_date_time_return}\",\n        \"arrivalTime\": \"{arrival_date_time_return}\",\n         \"airline\":\"{airline_name_return}\",\n         \"flightDuration\":\"{flight_duration_return}\"\n\n       },\n      \"bookingUrl\": \"{booking_url}\"\n    },\n  \"hotelOptions\": [\n    {\n      \"hotelName\": \"{hotel_name_1}\",\n      \"hotelAddress\": \"{hotel_address_1}\",\n      \"pricePerNight\": \"RM {price_hotel_1}\",\n      \"hotelImageUrl\": \"{hotel_image_url_1}\",\n      \"geoCoordinates\": {\n        \"latitude\": \"{latitude_hotel_1}\",\n        \"longitude\": \"{longitude_hotel_1}\"\n      },\n       \"rating\": \"{hotel_rating_1}\",\n      \"description\": \"{hotel_description_1}\"\n    },\n       {\n      \"hotelName\": \"{hotel_name_2}\",\n      \"hotelAddress\": \"{hotel_address_2}\",\n      \"pricePerNight\": \"RM {price_hotel_2}\",\n      \"hotelImageUrl\": \"{hotel_image_url_2}\",\n      \"geoCoordinates\": {\n        \"latitude\": \"{latitude_hotel_2}\",\n        \"longitude\": \"{longitude_hotel_2}\"\n      },\n         \"rating\": \"{hotel_rating_2}\",\n      \"description\": \"{hotel_description_2}\"\n    }\n\n  ],\n\n  \"dailyItinerary\": [\n      {\n        \"day\": 1,\n        \"theme\": \"{day_1_theme}\",\n         \"bestTimeToVisit\":\"{day_1_best_time}\",\n        \"activities\": [\n          {\n            \"placeName\": \"{place_name_day1_1}\",\n             \"placeDetails\":\"{place_details_day1_1}\",\n              \"placeImageUrl\":\"{place_image_url_day1_1}\",\n              \"geoCoordinates\":{\n                  \"latitude\":\"{latitude_place_day1_1}\",\n                   \"longitude\":\"{longitude_place_day1_1}\"\n             },\n              \"ticketPricing\":\"{price_place_day1_1}\",\n               \"timeTravel\":\"{time_travel_place_day1_1}\"\n\n          },\n           {\n            \"placeName\": \"{place_name_day1_2}\",\n             \"placeDetails\":\"{place_details_day1_2}\",\n              \"placeImageUrl\":\"{place_image_url_day1_2}\",\n              \"geoCoordinates\":{\n                  \"latitude\":\"{latitude_place_day1_2}\",\n                   \"longitude\":\"{longitude_place_day1_2}\"\n             },\n              \"ticketPricing\":\"{price_place_day1_2}\",\n               \"timeTravel\":\"{time_travel_place_day1_2}\"\n\n          }\n           ]\n      },\n      {\n       \"day\": 2,\n        \"theme\": \"{day_2_theme}\",\n        \"bestTimeToVisit\":\"{day_2_best_time}\",\n       \"activities\": [\n         {\n           \"placeName\": \"{place_name_day2_1}\",\n             \"placeDetails\":\"{place_details_day2_1}\",\n              \"placeImageUrl\":\"{place_image_url_day2_1}\",\n              \"geoCoordinates\":{\n                  \"latitude\":\"{latitude_place_day2_1}\",\n                   \"longitude\":\"{longitude_place_day2_1}\"\n             },\n              \"ticketPricing\":\"{price_place_day2_1}\",\n               \"timeTravel\":\"{time_travel_place_day2_1}\"\n         },\n          {\n            \"placeName\": \"{place_name_day2_2}\",\n             \"placeDetails\":\"{place_details_day2_2}\",\n              \"placeImageUrl\":\"{place_image_url_day2_2}\",\n              \"geoCoordinates\":{\n                  \"latitude\":\"{latitude_place_day2_2}\",\n                   \"longitude\":\"{longitude_place_day2_2}\"\n             },\n              \"ticketPricing\":\"{price_place_day2_2}\",\n               \"timeTravel\":\"{time_travel_place_day2_2}\"\n\n          }\n\n          ]\n      },\n  {\n       \"day\": 3,\n        \"theme\": \"{day_3_theme}\",\n        \"bestTimeToVisit\":\"{day_3_best_time}\",\n       \"activities\": [\n         {\n           \"placeName\": \"{place_name_day3_1}\",\n             \"placeDetails\":\"{place_details_day3_1}\",\n              \"placeImageUrl\":\"{place_image_url_day3_1}\",\n              \"geoCoordinates\":{\n                  \"latitude\":\"{latitude_place_day3_1}\",\n                   \"longitude\":\"{longitude_place_day3_1}\"\n             },\n              \"ticketPricing\":\"{price_place_day3_1}\",\n               \"timeTravel\":\"{time_travel_place_day3_1}\"\n\n         },\n           {\n            \"placeName\": \"{place_name_day3_2}\",\n             \"placeDetails\":\"{place_details_day3_2}\",\n              \"placeImageUrl\":\"{place_image_url_day3_2}\",\n              \"geoCoordinates\":{\n                  \"latitude\":\"{latitude_place_day3_2}\",\n                   \"longitude\":\"{longitude_place_day3_2}\"\n             },\n              \"ticketPricing\":\"{price_place_day3_2}\",\n               \"timeTravel\":\"{time_travel_place_day3_2}\"\n\n          }\n          ]\n      }\n    ]\n}\n```\n\n**Explanation of Placeholders:**\n\n*   `{location}`: The city or country you wish to travel to.\n*   `{number_of_days}`: How many days the trip will be.\n*   `{travel_companions}`:  Specify whether you're traveling solo, with family, friends, etc.\n*   `{budget}`: Your estimated budget for the trip.\n  *   `{purpose_of_travel}`: Purpose of travel (leisure, business,etc)\n  *   `{travel_season}`: When you will be travelling\n*  `{airport_code_destination}`: Airport code of your destination\n*   `{estimated_flight_price}`: Estimated return flight price.\n*   `{departure_date_time}`: Departure time of the outbound flight.\n  *  `{arrival_date_time}`: Arrival time of the outbound flight.\n    *   `{airline_name_outbound}`: Airline name outbound\n      *   `{flight_duration_outbound}`: Flight duration of the outbound flight.\n    *    `{departure_date_time_return}`: Departure time of the return flight.\n  *  `{arrival_date_time_return}`: Arrival time of the return flight.\n    *   `{airline_name_return}`: Airline name return\n      *   `{flight_duration_return}`: Flight duration of the return flight.\n\n*   `{booking_url}`:  URL to a flight booking website.\n*  `{hotel_name_1}`: Name of the first hotel option.\n    * `{hotel_address_1}`: Address of the first hotel.\n    *  `{price_hotel_1}`: Price per night for the first hotel.\n    * `{hotel_image_url_1}`: URL of the first hotel's image.\n    *  `{latitude_hotel_1}`, `{longitude_hotel_1}`: Coordinates for the first hotel.\n    *   `{hotel_rating_1}`: Rating of the hotel\n    *   `{hotel_description_1}`: Description of the first hotel.\n*  `{hotel_name_2}`: Name of the second hotel option.\n    * `{hotel_address_2}`: Address of the second hotel.\n    *  `{price_hotel_2}`: Price per night for the second hotel.\n    * `{hotel_image_url_2}`: URL of the second hotel's image.\n    *  `{latitude_hotel_2}`, `{longitude_hotel_2}`: Coordinates for the second hotel.\n    *  `{hotel_rating_2}`: Rating of the hotel\n    *  `{hotel_description_2}`: Description of the first hotel.\n*   `{day_1_theme}`, `{day_2_theme}`, `{day_3_theme}`: Theme for each day's activities (e.g., Cultural Exploration, Relaxation).\n*    `{day_1_best_time}`, `{day_2_best_time}`, `{day_3_best_time}`: Best time of the day to visit the selected attraction.\n*   `{place_name_day1_1}`,  `{place_name_day1_2}`, `{place_name_day2_1}` etc: Names of places to visit each day.\n    * `{place_details_day1_1}`, `{place_details_day1_2}`, `{place_details_day2_1}` etc: Detailed info about the places.\n    *   `{place_image_url_day1_1}`, `{place_image_url_day1_2}`, `{place_image_url_day2_1}` etc: Image URLs for each place.\n    *  `{latitude_place_day1_1}`,  `{longitude_place_day1_1}`, `{latitude_place_day1_2}`, `{longitude_place_day1_2}`, etc: Geo coordinates of each location.\n    *   `{price_place_day1_1}`, `{price_place_day1_2}` , `{price_place_day2_1}` etc: Ticket prices (if applicable).\n     *   `{time_travel_place_day1_1}`, `{time_travel_place_day1_2}`, `{time_travel_place_day2_1}` etc: Estimated travel times between each place.\n\n**How to Use:**\n\n1.  **Replace Placeholders:** Substitute all the `{placeholders}` with your specific data.\n2.  **Process:** You can copy this JSON and use it in your application or script for processing.\n3.  **Refine:** This structure is a template. You can add more details (like halal food options, prayer times, transportation details, etc.) as needed for your application.\n\n**Example of Usage:**\n\nFor a trip from Pahang to Kuala Lumpur for 3 days with family, a mid-range budget, you would fill out the placeholders with actual data.\n\n**Important Note:** Real-time information regarding flight and hotel prices fluctuates. Use booking sites and reliable sources for the most up-to-date pricing and availability when planning.\n\nI'm ready for you to give me specifics for your trip. Let me know your destination, travel dates, and what sort of travel you have in mind (e.g., beach vacation, historical tour, city exploration). The more specific you are, the better I can tailor the plan.\n"},
        ],
      },
    ],
    });


export const searchTravelDestination = model.startChat({
    generationConfig,
    history: [
      {
        role: "user",
        parts: [
          {text: "create placeName, desc and continent for moscow, russia in json format"},
        ],
      },
      {
        role: "model",
        parts: [
          {text: "```json\n{\n  \"placeName\": \"Moscow\",\n  \"desc\": \"Moscow is the capital and most populous city of Russia, a major political, economic, cultural, and scientific center. It is located on the Moskva River in Central Russia.\",\n  \"continent\": \"Europe\"\n}\n```\n"},
        ],
      },
    ],
})
